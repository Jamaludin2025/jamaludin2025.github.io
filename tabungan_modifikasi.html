<meta content="width=device-width, initial-scale=1" name="viewport"/><!DOCTYPE html>

<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Catatan Progres Tabungan</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
<style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: #f9fafb;
      color: #1f2937;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding-bottom: 72px; /* space for bottom tabs */
    }
    h3, h4 {
      font-weight: 600;
      color: #111827;
      margin-bottom: 12px;
    }
    /* Cards */
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgb(99 99 99 / 0.1);
      padding: 24px;
      margin: 20px auto;
      max-width: 480px;
      width: 90%;
      transition: box-shadow 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 12px 30px rgb(99 99 99 / 0.15);
    }

    /* Form */
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    input[type="text"],
    input[type="number"] {
      padding: 14px 16px;
      border: 1.8px solid #d1d5db;
      border-radius: 12px;
      font-size: 16px;
      transition: border-color 0.25s ease;
    }
    input[type="text"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 8px #3b82f6aa;
    }
    input[disabled] {
      background: #f3f4f6;
      color: #9ca3af;
      cursor: not-allowed;
    }

    /* Button */
    button {
      background-color: #2563eb;
      color: white;
      font-weight: 600;
      padding: 14px 0;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgb(37 99 235 / 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background-color: #1d4ed8;
      box-shadow: 0 6px 15px rgb(29 78 216 / 0.5);
    }
    button:disabled {
      background-color: #93c5fd;
      cursor: default;
      box-shadow: none;
    }

    /* Progress bar */
    .progress {
      background: #e0e7ff;
      border-radius: 20px;
      overflow: hidden;
      height: 28px;
      margin: 18px 0;
      box-shadow: inset 0 1px 3px rgb(0 0 0 / 0.1);
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #2563eb, #3b82f6);
      text-align: center;
      color: white;
      line-height: 28px;
      font-weight: 700;
      font-size: 14px;
      transition: width 0.5s ease-in-out;
      user-select: none;
    }

    #remaining {
      font-weight: 600;
      font-size: 15px;
      margin-top: 8px;
      color: #374151;
    }
    #remaining.success {
      color: #16a34a;
    }

    /* History List */
    ul {
      list-style-type: none;
      padding-left: 0;
      margin: 0;
      max-height: 220px;
      overflow-y: auto;
    }
    li {
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 8px;
      background: #f3f4f6;
      font-size: 15px;
      color: #374151;
      box-shadow: inset 1px 1px 2px #d1d5db;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Tabs */
    .tabs {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      display: flex;
      border-top: 1px solid #e5e7eb;
      height: 56px;
      box-shadow: 0 -2px 10px rgb(0 0 0 / 0.05);
      z-index: 1000;
      user-select: none;
    }
    .tab-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .tab-btn span.icon {
      font-size: 20px;
      margin-bottom: 4px;
      line-height: 1;
    }
    .tab-btn.active {
      color: #2563eb;
      border-top: 3px solid #2563eb;
      font-weight: 700;
    }

    /* Tab content */
    .tab-content {
      display: none;
      padding-top: 24px;
      padding-bottom: 12px;
      flex-grow: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .tab-content.active {
      display: block;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .card {
        padding: 18px;
      }
      button {
        font-size: 14px;
        padding: 12px 0;
      }
      input[type="text"],
      input[type="number"] {
        font-size: 14px;
        padding: 12px 14px;
      }
      #remaining {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
<div aria-label="Beranda Tabungan" class="tab-content active" id="beranda" role="main">
<div aria-live="polite" class="card">
<h3>Tambah Tabungan</h3>
<div class="form-group">
<input aria-label="Nama Barang" id="targetName" placeholder="Nama Barang (contoh: Laptop)" type="text"/>
<input aria-label="Target Harga Barang" id="targetAmount" placeholder="Target Harga Barang (Rp)" type="number"/>


</div>
</div>
<div aria-atomic="true" aria-live="polite" class="card" id="progressSection" style="display:none">
<h3>Progres Tabungan: <span id="displayTarget"></span></h3>
<div aria-valuemax="100" aria-valuemin="0" aria-valuenow="0" class="progress" id="progressContainer" role="progressbar">
<div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
</div>
<p id="remaining"></p>
<button id="rekapBtn" onclick="rekapTarget()">Rekap dan Selesai</button>
</div>
<div aria-live="polite" class="card" id="tabunganHistory" style="display:none">
<h4>Riwayat Tabungan</h4>
<ul id="historyList" tabindex="0"></ul>
</div>
</div>
<div aria-label="Riwayat Tabungan" class="tab-content" id="riwayat" role="region">
<div class="card">
<h3>Riwayat Barang Terkumpul</h3>
<ul id="rekapList" tabindex="0"></ul>
</div>
</div>
<nav aria-label="Navigasi Tab" class="tabs" role="tablist">
<div aria-controls="beranda" aria-selected="true" class="tab-btn active" id="tab-beranda" onclick="switchTab('beranda')" role="tab" tabindex="0">
<span aria-hidden="true" class="icon">üè†</span>Beranda
    </div>
<div aria-controls="riwayat" aria-selected="false" class="tab-btn" id="tab-riwayat" onclick="switchTab('riwayat')" role="tab" tabindex="-1">
<span aria-hidden="true" class="icon">üìú</span>Riwayat
    </div>
</nav><div id="plusButton" onclick="openPopup()" style="position: absolute; right: 16px; bottom: 72px; background-color: #2563eb; color: white; font-size: 28px; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; z-index: 1001;">+</div>
<script>
    function openPopup() {
      if (!document.getElementById('beranda').classList.contains('active')) return;
      document.getElementById('popupForm').style.display = 'flex';
    }
    function closePopup() {
      document.getElementById('popupForm').style.display = 'none';
    }
    
    let target = null;
    let totalSaved = 0;
    let startDate = null;
    let history = [];

    function switchTab(tab) {
      // Manage content visibility
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById(tab).classList.add('active');

      // Manage tab button active states and aria-selected/tabindex
      document.querySelectorAll('.tab-btn').forEach(btn => {
        if (btn.getAttribute('aria-controls') === tab) {
          btn.classList.add('active');
          btn.setAttribute('aria-selected', 'true');
          btn.setAttribute('tabindex', '0');
        } else {
          btn.classList.remove('active');
          btn.setAttribute('aria-selected', 'false');
          btn.setAttribute('tabindex', '-1');
        }
      });
    }

    function addSavings() {
      const inputAmount = parseInt(document.getElementById('inputAmount').value);
      const name = document.getElementById('targetName').value.trim();
      const amount = parseInt(document.getElementById('targetAmount').value);
      const today = new Date().toISOString().slice(0,10);

      if (!target) {
        if (!name || !amount || !inputAmount) return alert('Isi semua data terlebih dahulu.');
        target = { name, amount };
        startDate = new Date();
        document.getElementById('displayTarget').textContent = `${target.name} - Rp${target.amount.toLocaleString()}`;
        document.getElementById('progressSection').style.display = 'block';
        document.getElementById('tabunganHistory').style.display = 'block';

        // Disable input nama dan harga setelah target di-set
        document.getElementById('targetName').disabled = true;
        document.getElementById('targetAmount').disabled = true;
      }

      if (!inputAmount || inputAmount <= 0) return alert('Masukkan jumlah uang yang valid.');

      totalSaved += inputAmount;
      history.push({ date: today, amount: inputAmount });
      updateProgress();
      renderHistory();

      document.getElementById('inputAmount').value = '';

      saveData();
    }

    function updateProgress() {
      const percent = Math.min(100, (totalSaved / target.amount) * 100);
      const progressBar = document.getElementById('progressBar');
      progressBar.style.width = percent + '%';
      progressBar.textContent = Math.floor(percent) + '%';
      progressBar.parentElement.setAttribute('aria-valuenow', Math.floor(percent));
      const remaining = target.amount - totalSaved;
      const remainingEl = document.getElementById('remaining');
      if (remaining > 0) {
        remainingEl.textContent = `Kurang Rp${remaining.toLocaleString()} lagi`;
        remainingEl.classList.remove('success');
      } else {
        remainingEl.textContent = 'Target tercapai!';
        remainingEl.classList.add('success');
      }
    }

    function renderHistory() {
      const list = document.getElementById('historyList');
      list.innerHTML = '';
      history.forEach(entry => {
        const li = document.createElement('li');
        li.textContent = `${entry.date}: Rp${entry.amount.toLocaleString()}`;
        list.appendChild(li);
      });
    }

    function rekapTarget() {
      if (!target || totalSaved < target.amount) {
        alert('Target belum tercapai.');
        return;
      }
      const endDate = new Date();
      const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
      const li = document.createElement('li');
      li.textContent = `${target.name} - Rp${target.amount.toLocaleString()} - Terkumpul dalam ${days} hari.`;
      document.getElementById('rekapList').appendChild(li);

      // Reset
      target = null;
      totalSaved = 0;
      startDate = null;
      history = [];
      document.getElementById('progressSection').style.display = 'none';
      document.getElementById('tabunganHistory').style.display = 'none';
      document.getElementById('historyList').innerHTML = '';
      document.getElementById('targetName').value = '';
      document.getElementById('targetAmount').value = '';

      // Enable input nama dan harga lagi
      document.getElementById('targetName').disabled = false;
      document.getElementById('targetAmount').disabled = false;

      saveData();

      switchTab('riwayat');
    }

    // Simpan data ke localStorage
    function saveData() {
      localStorage.setItem('tabunganTarget', JSON.stringify(target));
      localStorage.setItem('tabunganTotal', totalSaved);
      localStorage.setItem('tabunganHistory', JSON.stringify(history));
      localStorage.setItem('tabunganStartDate', startDate ? startDate.toISOString() : null);
      localStorage.setItem('tabunganRekap', document.getElementById('rekapList').innerHTML);
    }

    // Muat data dari localStorage saat halaman load
    function loadData() {
      const savedTarget = localStorage.getItem('tabunganTarget');
      const savedTotal = localStorage.getItem('tabunganTotal');
      const savedHistory = localStorage.getItem('tabunganHistory');
      const savedStartDate = localStorage.getItem('tabunganStartDate');
      const savedRekap = localStorage.getItem('tabunganRekap');

      if (savedTarget && savedTotal && savedHistory) {
        target = JSON.parse(savedTarget);
        totalSaved = parseInt(savedTotal);
        history = JSON.parse(savedHistory);
        startDate = savedStartDate ? new Date(savedStartDate) : null;

        document.getElementById('displayTarget').textContent = `${target.name} - Rp${target.amount.toLocaleString()}`;
        document.getElementById('progressSection').style.display = 'block';
        document.getElementById('tabunganHistory').style.display = 'block';

        document.getElementById('targetName').value = target.name;
        document.getElementById('targetAmount').value = target.amount;

        document.getElementById('targetName').disabled = true;
        document.getElementById('targetAmount').disabled = true;

        updateProgress();
        renderHistory();
      }

      if (savedRekap) {
        document.getElementById('rekapList').innerHTML = savedRekap;
      }
    }

    window.onload = () => {
      loadData();
    };
  </script>
<div id="popupForm" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; align-items: center; justify-content: center;"><div style="background: white; padding: 24px; border-radius: 16px; max-width: 400px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
<h3>Tambah Tabungan Hari Ini</h3>
<input id="inputAmount" placeholder="Jumlah Uang Ditabung Hari Ini (Rp)" style="width: 100%; padding: 12px; margin: 12px 0; border: 1px solid #ccc; border-radius: 10px;" type="number"/>
<button onclick="addSavings(); closePopup();">Simpan</button>
<button onclick="closePopup();" style="margin-top: 10px; background-color: #9ca3af;">Batal</button>
</div></div></body>
</html>
