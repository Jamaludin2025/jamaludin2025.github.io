<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Progres Tabungan</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
      transition: all 0.3s ease;
    }
    body {
      margin: 0;
      padding: 0;
      background: #eef2f7;
      color: #333;
    }
    .tab-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #3f51b5;
      color: white;
      padding: 1rem 2rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .tab-header h2 {
      margin: 0;
      font-size: 1.5rem;
    }
    .tab-button {
      background: #ff9800;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    .tab-button:hover {
      background: #fb8c00;
    }
    .tab-switcher {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }
    .tab-switcher button {
      margin: 0 0.5rem;
      background: white;
      border: 2px solid #3f51b5;
      color: #3f51b5;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 500;
    }
    .tab-switcher button:hover {
      background: #3f51b5;
      color: white;
    }
    .tabs {
      max-width: 700px;
      margin: auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .tab-content {
      display: none;
      padding: 2rem;
      animation: fadeIn 0.4s ease;
    }
    .tab-content.active {
      display: block;
    }
    .progress-section, .history-section {
      margin-bottom: 2rem;
    }
    .progress-bar {
      background: #ccc;
      border-radius: 20px;
      overflow: hidden;
      height: 25px;
      margin-top: 1rem;
    }
    .progress-fill {
      height: 100%;
      background: #4caf50;
      width: 0%;
      text-align: center;
      color: white;
      font-weight: bold;
      transition: width 0.5s ease;
    }
    .popup {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup-content {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 400px;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 0.75rem;
      margin: 1rem 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 25px;
      cursor: pointer;
    }
    .success {
      background: #4caf50;
      color: white;
      font-weight: bold;
    }
    .success:hover {
      background: #43a047;
    }
    .danger {
      background: #e53935;
      color: white;
      font-weight: bold;
      margin-top: 0.5rem;
    }
    .danger:hover {
      background: #c62828;
    }
    .log-entry, .target-entry {
      padding: 0.75rem;
      border-bottom: 1px solid #eee;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 600px) {
      .tab-header h2 {
        font-size: 1.2rem;
      }
      .tab-button {
        padding: 0.5rem 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="tab-header">
    <h2 id="tabTitle">Beranda</h2>
    <button class="tab-button" onclick="openPopup()">+</button>
  </div>

  <div class="tab-switcher">
    <button onclick="switchTab('beranda')">Beranda</button>
    <button onclick="switchTab('riwayat')">Riwayat</button>
  </div>

  <div class="tabs">
    <div id="beranda" class="tab-content active">
      <div class="progress-section">
        <div id="targetDisplay"></div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill">0%</div>
        </div>
        <button id="finishBtn" class="success" onclick="markAsComplete()" style="display: none; margin-top:1rem">Selesai</button>
      </div>
      <div class="history-section">
        <h3>Riwayat Nabung</h3>
        <div id="logList"></div>
      </div>
    </div>
    <div id="riwayat" class="tab-content">
      <h3>Target Tercapai</h3>
      <div id="completedList"></div>
    </div>
  </div>

  <div class="popup" id="popup">
    <div class="popup-content" id="popupContent"></div>
  </div>

  <script>
    let currentTarget = JSON.parse(localStorage.getItem("target")) || null;
    let savings = JSON.parse(localStorage.getItem("savings")) || [];
    let completed = JSON.parse(localStorage.getItem("completed")) || [];

    function updateUI() {
      const targetDisplay = document.getElementById("targetDisplay");
      const progressFill = document.getElementById("progressFill");
      const finishBtn = document.getElementById("finishBtn");
      const logList = document.getElementById("logList");
      const completedList = document.getElementById("completedList");

      targetDisplay.innerHTML = "";
      logList.innerHTML = "";

      if (currentTarget) {
        const totalSaved = savings.reduce((a, b) => a + b.amount, 0);
        const percent = Math.min((totalSaved / currentTarget.price) * 100, 100);
        progressFill.style.width = percent + "%";
        progressFill.innerText = Math.floor(percent) + "%";
        targetDisplay.innerHTML = `<p><strong>${currentTarget.name}</strong><br>Harga: Rp${currentTarget.price.toLocaleString()}<br>Terkumpul: Rp${totalSaved.toLocaleString()}<br>Kurang: Rp${Math.max(currentTarget.price - totalSaved, 0).toLocaleString()}</p>`;
        finishBtn.style.display = totalSaved >= currentTarget.price ? "inline-block" : "none";

        savings.forEach(entry => {
          logList.innerHTML += `<div class='log-entry'>${entry.date} - Rp${entry.amount.toLocaleString()}</div>`;
        });
      } else {
        progressFill.style.width = "0%";
        progressFill.innerText = "0%";
      }

      completedList.innerHTML = "";
      completed.forEach((item, index) => {
        completedList.innerHTML += `
          <div class='target-entry'>
            ${item.name} tercapai dalam ${item.days} hari.
            <button class='danger' onclick='confirmDelete(${index})'>Hapus</button>
          </div>`;
      });

      localStorage.setItem("target", JSON.stringify(currentTarget));
      localStorage.setItem("savings", JSON.stringify(savings));
      localStorage.setItem("completed", JSON.stringify(completed));
    }

    function openPopup() {
      const popup = document.getElementById("popup");
      const popupContent = document.getElementById("popupContent");
      popup.style.display = "flex";

      if (!currentTarget) {
        popupContent.innerHTML = `
          <h3>Tambah Target</h3>
          <input type="text" id="targetName" placeholder="Nama Barang" />
          <input type="number" id="targetPrice" placeholder="Harga Barang" />
          <button class="success" onclick="saveTarget()">Simpan</button>
        `;
      } else {
        popupContent.innerHTML = `
          <h3>Tambah Tabungan</h3>
          <input type="number" id="savingAmount" placeholder="Nominal Tabungan" />
          <button class="success" onclick="saveSaving()">Simpan</button>
        `;
      }
    }

    function saveTarget() {
      const name = document.getElementById("targetName").value;
      const price = parseInt(document.getElementById("targetPrice").value);
      if (name && price > 0) {
        currentTarget = { name, price, startDate: new Date().toISOString() };
        savings = [];
        closePopup();
        updateUI();
      }
    }

    function saveSaving() {
      const amount = parseInt(document.getElementById("savingAmount").value);
      if (amount > 0) {
        const now = new Date();
        savings.push({ date: now.toLocaleDateString("id-ID"), amount });
        closePopup();
        updateUI();
      }
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    function markAsComplete() {
      const endDate = new Date();
      const startDate = new Date(currentTarget.startDate);
      const diffDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
      completed.push({ name: currentTarget.name, days: diffDays });
      currentTarget = null;
      savings = [];
      updateUI();
    }

    function switchTab(tabName) {
      document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
      document.getElementById(tabName).classList.add("active");
      document.getElementById("tabTitle").innerText = tabName === "beranda" ? "Beranda" : "Riwayat";
    }

    function confirmDelete(index) {
      if (confirm("Apakah Anda yakin ingin menghapus riwayat ini?")) {
        completed.splice(index, 1);
        updateUI();
      }
    }

    window.onload = updateUI;
  </script>
</body>
</html>
