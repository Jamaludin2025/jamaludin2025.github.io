<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login Undangan</title>
  <style>
    /* Tetap gunakan gaya yang sama dari file sebelumnya */
    body { font-family: sans-serif; background: #f0f4f8; margin: 0; padding: 0; }
    .login-container { max-width: 400px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .tab-container { display: flex; margin-bottom: 16px; }
    .tab-button { flex: 1; padding: 10px; border: none; cursor: pointer; background: #e2e8f0; border-radius: 6px 6px 0 0; }
    .tab-button.active { background: #fff; font-weight: bold; }
    label { display: block; margin-bottom: 6px; font-size: 14px; }
    input[type="text"] { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 10px; width: 100%; border: none; border-radius: 6px; background: #2563eb; color: white; cursor: pointer; }
    small { display: none; font-size: 12px; color: #64748b; margin-top: -8px; margin-bottom: 8px; }
    #error-message, #success-message { text-align: center; font-size: 14px; margin-top: 10px; }
    #error-message { color: red; }
    #success-message { color: green; }
    .log-item { border-bottom: 1px solid #e5e7eb; padding: 6px 0; display: flex; justify-content: space-between; }
    .log-item button { background: red; font-size: 12px; padding: 2px 6px; width: auto; margin-left: 10px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="login-container">
    <h2 id="judul-form">Cek Data Undangan</h2>
    <div id="tanggal-hari"></div>
    <div class="tab-container">
      <button class="tab-button active" id="tab-login" onclick="switchTab('login')">Beranda</button>
      <button class="tab-button" id="tab-admin" onclick="switchTab('admin')">Admin</button>
    </div>
    <form id="form-login" onsubmit="return false;">
      <label for="kodeAkses">Kode Akses</label>
      <input type="text" id="kodeAkses" placeholder="Masukkan Kode Akses" onfocus="tampilkanInfo()" onblur="sembunyikanInfo()" autocomplete="off" />
      <small id="infoKode">Kode Akses Tertera di Amplop Undangan.</small>
      <button type="button" onclick="prosesLogin()">Masuk</button>
    </form>
    <form id="form-admin" style="display:none;" onsubmit="return false;">
      <label for="kodeAdmin">Kode Akses Admin</label>
      <input type="text" id="kodeAdmin" placeholder="Masukkan Kode Akses" onfocus="tampilkanInfoAdmin()" onblur="sembunyikanInfoAdmin()" autocomplete="off" />
      <small id="infoKodeAdmin">Kode Akses Admin Rahasia.</small>
      <button type="button" onclick="prosesAdmin()">Masuk Sebagai Admin</button>
      <div id="admin-log" style="margin-top:20px;"></div>
    </form>
    <div id="error-message"></div>
    <div id="success-message"></div>
  </div>

  <script>
    const aksesMap = {
      "abc": "https://jamaludin2025.github.io/qr15.html",
      "AJ5394": "https://jamaludin2025.github.io/qr5.html",
      "TES456": "halaman-rahasia.html"
    };
    const adminKode = "Admin123";

    const firebaseConfig = {
      apiKey: "AIzaSyBdt-2IQflUWNx3sdI1QHPMe1vAzsXAZcY",
      authDomain: "ajproject-log.firebaseapp.com",
      databaseURL: "https://ajproject-log-default-rtdb.firebaseio.com/",
      projectId: "ajproject-log",
      storageBucket: "ajproject-log.appspot.com",
      messagingSenderId: "113688767697",
      appId: "1:113688767697:web:ca9ad012667acb7474a9f0",
      measurementId: "G-6PLCT8D53G"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function switchTab(tab) {
      document.getElementById("form-login").style.display = (tab === "login") ? "block" : "none";
      document.getElementById("form-admin").style.display = (tab === "admin") ? "block" : "none";
      document.getElementById("tab-login").classList.toggle("active", tab === "login");
      document.getElementById("tab-admin").classList.toggle("active", tab === "admin");
      document.getElementById("judul-form").textContent = (tab === "login") ? "Cek Data Undangan" : "Beranda Admin";
      document.getElementById("kodeAkses").value = "";
      document.getElementById("kodeAdmin").value = "";
      document.getElementById("infoKode").style.display = "none";
      document.getElementById("infoKodeAdmin").style.display = "none";
      document.getElementById("error-message").textContent = "";
      document.getElementById("success-message").textContent = "";
      if (tab === "admin") ambilLog();
    }

    function tampilkanInfo() {
      document.getElementById("infoKode").style.display = "block";
    }
    function sembunyikanInfo() {
      document.getElementById("infoKode").style.display = "none";
    }
    function tampilkanInfoAdmin() {
      document.getElementById("infoKodeAdmin").style.display = "block";
    }
    function sembunyikanInfoAdmin() {
      document.getElementById("infoKodeAdmin").style.display = "none";
    }

    function prosesLogin() {
      const kode = document.getElementById("kodeAkses").value.trim().toUpperCase();
      const pesanError = document.getElementById("error-message");
      const pesanSukses = document.getElementById("success-message");
      pesanError.textContent = "";
      pesanSukses.textContent = "";

      if (aksesMap[kode]) {
        const waktu = new Date().toLocaleString("id-ID", { timeZone: "Asia/Jakarta" });
        database.ref("log").push({ kode, waktu });
        pesanSukses.textContent = "Selamat, Kode Akses Diterima.";
        setTimeout(() => window.location.href = aksesMap[kode], 2500);
      } else {
        pesanError.textContent = "Maaf, Kode Akses Ditolak.";
      }
    }

    function prosesAdmin() {
      const input = document.getElementById("kodeAdmin").value.trim();
      if (input === adminKode) {
        document.getElementById("success-message").textContent = "Berhasil masuk sebagai Admin.";
        ambilLog();
      } else {
        document.getElementById("error-message").textContent = "Kode Akses Salah.";
      }
    }

    function ambilLog() {
      const adminLog = document.getElementById("admin-log");
      database.ref("log").once("value", snapshot => {
        adminLog.innerHTML = "";
        const data = snapshot.val();
        if (data) {
          Object.entries(data).reverse().forEach(([id, log]) => {
            const div = document.createElement("div");
            div.className = "log-item";
            div.innerHTML = `Kode: ${log.kode}, Waktu: ${log.waktu} <button onclick="hapusLog('${id}')">Hapus</button>`;
            adminLog.appendChild(div);
          });
        } else {
          adminLog.textContent = "Belum ada login pengguna.";
        }
      });
    }

    function hapusLog(id) {
      database.ref("log/" + id).remove().then(() => ambilLog());
    }

    function updateTanggalHari() {
      const tanggalHari = document.getElementById("tanggal-hari");
      const hari = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
      const bulan = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
      setInterval(() => {
        const now = new Date();
        const teksTanggal = `${hari[now.getDay()]}, ${now.getDate()} ${bulan[now.getMonth()]} ${now.getFullYear()}`;
        const teksWaktu = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        tanggalHari.textContent = `${teksTanggal} - ${teksWaktu}`;
      }, 1000);
    }

    updateTanggalHari();
  </script>
</body>
</html>
